modelVersion: 4.0.0

groupId: io.mikael.poc
artifactId: kotlin-tensorflow-segmentation-poc
name: kotlin-tensorflow-segmentation-poc
version: 1.0.0
packaging: jar

parent: {groupId: org.springframework.boot, artifactId: spring-boot-starter-parent, version: '2.2.1.RELEASE'}

properties:
  'java.version': '11'
  'kotlin.version': '1.3.61'
  'tensorflow.version': '1.15.0'

profiles:

  - id: cpu
    activation: {activeByDefault: true}
    dependencies:
      - {groupId: org.tensorflow, artifactId: tensorflow, version: "${tensorflow.version}"}
    build:
      plugins:
        - groupId: org.springframework.boot
          artifactId: spring-boot-maven-plugin
          configuration:
            classifier: cpu

  - id: gpu
    activation: {activeByDefault: false}
    dependencies:
      - {groupId: org.tensorflow, artifactId: tensorflow, version: "${tensorflow.version}",
         exclusions: [{groupId: org.tensorflow, artifactId: libtensorflow_jni}]}
      - {groupId: org.tensorflow, artifactId: libtensorflow_jni_gpu, version: "${tensorflow.version}"}
    build:
      plugins:
        - groupId: org.springframework.boot
          artifactId: spring-boot-maven-plugin
          configuration:
            classifier: gpu
        - artifactId: maven-surefire-plugin
          configuration:
            skipTests: true

dependencies:

  # Tensorflow protocol buffers
  - {groupId: org.tensorflow, artifactId: proto, version: "${tensorflow.version}"}
  - {groupId: com.google.protobuf, artifactId: protobuf-java, version: 3.10.0}

  # Spring Boot
  - {groupId: org.springframework.boot, artifactId: spring-boot-starter-webflux,
     exclusions: [{groupId: org.hibernate, artifactId: '*'}, {groupId: org.hibernate.validator, artifactId: '*'}]}
  - {groupId: org.springframework.boot, artifactId: spring-boot-starter-thymeleaf}

  - {scope: test, groupId: org.springframework.boot, artifactId: spring-boot-starter-test}

  - {groupId: org.springframework.boot, artifactId: spring-boot-devtools, optional: true}

  # Kotlin
  - {groupId: org.jetbrains.kotlin, artifactId: kotlin-stdlib-jdk8, version: "${kotlin.version}"}
  - {groupId: org.jetbrains.kotlin, artifactId: kotlin-reflect, version: "${kotlin.version}"}

build:
  sourceDirectory: src/main/kotlin
  testSourceDirectory: src/test/kotlin
  plugins:
    - {groupId: org.springframework.boot, artifactId: spring-boot-maven-plugin}
    - groupId: org.jetbrains.kotlin
      artifactId: kotlin-maven-plugin
      version: "${kotlin.version}"
      configuration: {jvmTarget: '1.8', compilerPlugins: {plugin: 'spring'}}
      executions:
        - {id: compile, phase: compile, goals: ['compile']}
        - {id: test-compile, phase: test-compile, goals: ['test-compile']}
      dependencies:
        - {groupId: org.jetbrains.kotlin, artifactId: kotlin-maven-allopen, version: "${kotlin.version}"}
